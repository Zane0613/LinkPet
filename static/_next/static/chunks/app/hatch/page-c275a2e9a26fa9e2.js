(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[948],{6686:function(e,t,a){Promise.resolve().then(a.bind(a,6548))},6548:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(3827),r=a(4090),n=a(7907),i=a(826),l=a(4391),o=a(8371);let c=[{q:"你会把蛋放在哪里孵化？",options:["舒适的床边小窝","阳光充足的落地窗边","通风的阳台或门口"]},{q:"你每天如何与蛋互动？",options:["轻声讲故事或哼唱","播放电子音乐","给它看外面的风景"]},{q:"选一个礼物放在蛋旁边：",options:["柔软的棉球","微型厨具","闪亮的机械零件","一袋多彩的坚果"]},{q:"为最后阶段选择一种环境音：",options:["森林里的雨声","熙熙攘攘的街道","电子嗡嗡声"]},{q:"你希望它有什么特长？",options:["跑得非常快","超级聪明","运气特别好"]},{q:"你会带它去哪里玩？",options:["热闹的游乐园","安静的图书馆","神秘的森林"]}];function d(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[p,h]=(0,r.useState)(!1),[x,m]=(0,r.useState)(!1),[f,b]=(0,r.useState)(0),[g,v]=(0,r.useState)(0),[y,j]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),[N,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=setTimeout(()=>{k(!0)},1e3);return()=>clearTimeout(e)},[]),(0,r.useEffect)(()=>{"true"===sessionStorage.getItem("hatch_answered_this_session")&&j(!0)},[]);let E=async()=>{try{let t=(await i.Z.get("/pet/my/all")).data;if(Array.isArray(t)&&t.length>0){let e=t[0];a(e),b(e.hatch_progress_seconds),v(e.heat_buffer_seconds)}else e.push("/claim")}catch(e){console.error("Failed to fetch pet:",e)}finally{u(!1)}};(0,r.useEffect)(()=>{E();let e=setInterval(E,1e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{let e=setInterval(()=>{g>0&&f<180&&(v(e=>Math.max(0,e-1)),b(e=>Math.min(180,e+1)))},1e3);return()=>clearInterval(e)},[g,f]);let C=(null==t?void 0:t.status)==="egg_frozen",S=(null==t?void 0:t.status)==="egg_dead",I=(null==t?void 0:t.status)==="egg_hatched"||(null==t?void 0:t.status)==="sleeping"||(null==t?void 0:t.status)==="eating"||(null==t?void 0:t.status)==="traveling",D=g>0;(0,r.useEffect)(()=>{},[S]),(0,r.useEffect)(()=>{I&&!_&&w(!0)},[I,_]),(0,r.useEffect)(()=>{if(_){let t=setTimeout(()=>{e.push("/naming")},6500);return()=>clearTimeout(t)}},[_,e]);let P=async e=>{if(t){m(!0);try{let a=t.hatch_answers.length;await i.Z.post("/pet/heat",{question_index:a,answer_index:e}),h(!1),E()}catch(e){console.error("Answer failed:",e),alert("提交失败")}finally{m(!1)}}};if(d)return(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-[#FFF8E7]",children:"加载中..."});if(S)return(0,s.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-center p-8 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(/images/backgrounds/hatch-bg.png)"},children:(0,s.jsxs)("div",{className:"text-center p-8 bg-white/90 rounded-3xl border-4 border-black shadow-lg backdrop-blur-sm",children:[(0,s.jsx)("h1",{className:"text-4xl mb-4",children:"\uD83D\uDC80"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"孵化失败"}),(0,s.jsx)("p",{className:"mb-8",children:"蛋因为长时间没有加热冻死了..."}),(0,s.jsx)("button",{onClick:()=>{e.push("/claim")},className:"px-8 py-3 bg-red-400 border-2 border-black rounded-xl font-bold hover:bg-red-500 transition-colors",children:"重新领取"})]})});let R=(null==t?void 0:t.hatch_answers.length)||0,M=c[R];return(0,s.jsxs)(o.E.main,{className:"relative min-h-screen flex flex-col justify-between p-4 bg-cover bg-center bg-no-repeat overflow-hidden",style:{backgroundImage:"url(/images/backgrounds/hatch-bg.png)"},initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:[(0,s.jsxs)(o.E.div,{className:"w-full max-w-md mx-auto pt-0 z-10 space-y-2",initial:{opacity:0,y:-20},animate:{opacity:N&&!_?1:0,y:N&&!_?0:-20},transition:{duration:1},children:[(0,s.jsx)("div",{className:"text-center mb-2",children:(0,s.jsx)("h1",{className:"text-2xl font-black text-white drop-shadow-[2px_2px_0px_rgba(0,0,0,0.8)] transform -rotate-2",children:C?"\uD83E\uDD76 蛋冻僵了！":D?"\uD83D\uDD25 正在加热...":"❄️ 等待加热"})}),(0,s.jsxs)("div",{className:"bg-white/90 p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("span",{className:"font-bold text-sm",children:"孵化进度"}),(0,s.jsxs)("span",{className:"font-mono font-black text-orange-500",children:[Math.floor(f/180*100),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 h-4 rounded-full border-2 border-black overflow-hidden",children:(0,s.jsx)("div",{className:"bg-orange-400 h-full transition-all duration-1000",style:{width:"".concat(f/180*100,"%")}})})]}),(0,s.jsxs)("div",{className:"bg-white/90 p-4 rounded-2xl border-4 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold text-sm",children:"剩余热量"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"保持加热才能孵化哦"})]}),(0,s.jsx)("span",{className:"font-mono text-2xl font-black ".concat(g>0?"text-red-500 animate-pulse":"text-gray-400"),children:"".concat(Math.floor(g/3600).toString().padStart(2,"0"),":").concat(Math.floor(g%3600/60).toString().padStart(2,"0"),":").concat((g%60).toString().padStart(2,"0"))})]})]}),(0,s.jsx)("div",{className:"flex-grow flex items-end justify-center z-0 pb-28",children:(0,s.jsx)(o.E.div,{whileTap:{rotate:[0,-2,2,-2,2,0],scale:.98,transition:{duration:.3}},animate:_?{x:[-5,5,-5,5],rotate:[-2,2,-2,2],filter:["brightness(1)","brightness(2)","brightness(5)"],transition:{x:{repeat:1/0,duration:.5,repeatType:"mirror"},rotate:{repeat:1/0,duration:.5,repeatType:"mirror"},filter:{duration:6,ease:"easeIn"}}}:D?{filter:["brightness(1) sepia(0) saturate(1)","brightness(1.1) sepia(0.3) saturate(1.2)","brightness(1) sepia(0) saturate(1)"],transition:{filter:{repeat:1/0,duration:1.5,ease:"easeInOut",repeatType:"reverse"}}}:{},className:"cursor-pointer relative",children:(0,s.jsx)("img",{src:C?"/images/ui/egg-cold.png":D?"/images/ui/egg-warm.png":"/images/ui/egg.png",alt:"Pet Egg",className:"w-48 h-auto md:w-60 drop-shadow-2xl",draggable:!1})})}),(0,s.jsx)(o.E.div,{className:"w-full max-w-md mx-auto pb-8 z-10",initial:{opacity:0,y:20},animate:{opacity:N&&!_?1:0,y:N&&!_?0:20},transition:{duration:1},children:R<6?y?(0,s.jsxs)("div",{className:"text-center bg-white/80 p-4 rounded-xl border-2 border-black",children:[(0,s.jsx)("p",{className:"font-bold text-gray-800",children:"本次上线已回答过问题"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"请稍后回来再试！"})]}):(0,s.jsx)("button",{onClick:()=>h(!0),className:"w-full py-4 bg-[#FFB347] text-black border-2 border-black rounded-xl font-black text-lg shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] hover:translate-y-[2px] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:shadow-none active:translate-y-[4px] transition-all",children:"回答问题 (+2分钟热量)"}):(0,s.jsx)("div",{className:"text-center text-gray-500 font-bold bg-white/50 p-4 rounded-xl",children:"已完成所有问答，等待孵化..."})}),_&&(0,s.jsx)(o.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:2,delay:4,ease:"easeIn"},className:"fixed inset-0 bg-white z-50 pointer-events-none"}),p&&M&&(0,s.jsx)(l.Z,{isOpen:p,onClose:()=>h(!1),title:"问题 ".concat(R+1,"/").concat(6),children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-lg font-bold mb-4",children:M.q}),(0,s.jsx)("div",{className:"space-y-3",children:M.options.map((e,t)=>(0,s.jsx)("button",{onClick:()=>P(t),disabled:x,className:"w-full p-3 text-left border-2 border-black rounded-xl hover:bg-orange-100 transition-colors font-medium",children:e},t))})]})})]})}},4391:function(e,t,a){"use strict";a.d(t,{Z:function(){return v}});var s=a(3827),r=a(4090),n=a(3856),i=a(2435),l=a(4561),o=a(3449);class c extends r.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d(e){let{children:t,isPresent:a}=e,n=(0,r.useId)(),i=(0,r.useRef)(null),l=(0,r.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,r.useContext)(o._);return(0,r.useInsertionEffect)(()=>{let{width:e,height:t,top:s,left:r}=l.current;if(a||!i.current||!e||!t)return;i.current.dataset.motionPopId=n;let o=document.createElement("style");return d&&(o.nonce=d),document.head.appendChild(o),o.sheet&&o.sheet.insertRule('\n          [data-motion-pop-id="'.concat(n,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(s,"px !important;\n            left: ").concat(r,"px !important;\n          }\n        ")),()=>{document.head.removeChild(o)}},[a]),(0,s.jsx)(c,{isPresent:a,childRef:i,sizeRef:l,children:r.cloneElement(t,{ref:i})})}let u=e=>{let{children:t,initial:a,isPresent:n,onExitComplete:o,custom:c,presenceAffectsLayout:u,mode:h}=e,x=(0,i.h)(p),m=(0,r.useId)(),f=(0,r.useCallback)(e=>{for(let t of(x.set(e,!0),x.values()))if(!t)return;o&&o()},[x,o]),b=(0,r.useMemo)(()=>({id:m,initial:a,isPresent:n,custom:c,onExitComplete:f,register:e=>(x.set(e,!1),()=>x.delete(e))}),u?[Math.random(),f]:[n,f]);return(0,r.useMemo)(()=>{x.forEach((e,t)=>x.set(t,!1))},[n]),r.useEffect(()=>{n||x.size||!o||o()},[n]),"popLayout"===h&&(t=(0,s.jsx)(d,{isPresent:n,children:t})),(0,s.jsx)(l.O.Provider,{value:b,children:t})};function p(){return new Map}var h=a(3177);let x=e=>e.key||"";function m(e){let t=[];return r.Children.forEach(e,e=>{(0,r.isValidElement)(e)&&t.push(e)}),t}var f=a(5526);let b=e=>{let{children:t,custom:a,initial:l=!0,onExitComplete:o,presenceAffectsLayout:c=!0,mode:d="sync",propagate:p=!1}=e,[b,g]=(0,h.oO)(p),v=(0,r.useMemo)(()=>m(t),[t]),y=p&&!b?[]:v.map(x),j=(0,r.useRef)(!0),_=(0,r.useRef)(v),w=(0,i.h)(()=>new Map),[N,k]=(0,r.useState)(v),[E,C]=(0,r.useState)(v);(0,f.L)(()=>{j.current=!1,_.current=v;for(let e=0;e<E.length;e++){let t=x(E[e]);y.includes(t)?w.delete(t):!0!==w.get(t)&&w.set(t,!1)}},[E,y.length,y.join("-")]);let S=[];if(v!==N){let e=[...v];for(let t=0;t<E.length;t++){let a=E[t],s=x(a);y.includes(s)||(e.splice(t,0,a),S.push(a))}"wait"===d&&S.length&&(e=S),C(m(e)),k(v);return}let{forceRender:I}=(0,r.useContext)(n.p);return(0,s.jsx)(s.Fragment,{children:E.map(e=>{let t=x(e),r=(!p||!!b)&&(v===E||y.includes(t));return(0,s.jsx)(u,{isPresent:r,initial:(!j.current||!!l)&&void 0,custom:r?void 0:a,presenceAffectsLayout:c,mode:d,onExitComplete:r?void 0:()=>{if(!w.has(t))return;w.set(t,!0);let e=!0;w.forEach(t=>{t||(e=!1)}),e&&(null==I||I(),C(_.current),p&&(null==g||g()),o&&o())},children:e},t)})})};var g=a(8371);function v(e){let{isOpen:t,onClose:a,title:r,message:n,children:i,confirmText:l="好的",cancelText:o="取消",onConfirm:c,type:d="info"}=e;return(0,s.jsx)(b,{children:t&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,s.jsx)(g.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:a}),(0,s.jsxs)(g.E.div,{initial:{scale:.9,rotate:-2,opacity:0},animate:{scale:1,rotate:0,opacity:1},exit:{scale:.9,rotate:2,opacity:0},className:"relative bg-white p-8 rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] max-w-md w-full",children:[(0,s.jsx)("button",{onClick:a,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center border-2 border-black rounded-full hover:bg-gray-100 transition-colors",children:(0,s.jsx)("span",{className:"font-bold text-lg leading-none mb-1",children:"x"})}),(0,s.jsx)("h2",{className:"text-2xl font-black mb-4 text-center transform -rotate-1",children:r}),(0,s.jsx)("div",{className:"mb-8 text-lg font-medium text-gray-800 text-center leading-relaxed",children:n||i}),(0,s.jsxs)("div",{className:"flex justify-center gap-6",children:["confirm"===d&&(0,s.jsx)("button",{onClick:a,className:"px-6 py-2 bg-white border-2 border-black rounded-xl font-bold hover:bg-gray-50 active:translate-y-1 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)]",children:o}),(0,s.jsx)("button",{onClick:c||a,className:"px-6 py-2 bg-[#FFD700] border-2 border-black rounded-xl font-bold hover:brightness-105 active:translate-y-1 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:l})]})]})]})})}},826:function(e,t,a){"use strict";var s=a(3107),r=a(9079);let n=s.Z.create({baseURL:r.env.NEXT_PUBLIC_API_URL||"/api/v1",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let t=localStorage.getItem("linkpet_user_id");t&&(e.headers["X-User-ID"]=t)}return e},e=>Promise.reject(e)),t.Z=n}},function(e){e.O(0,[615,371,971,69,744],function(){return e(e.s=6686)}),_N_E=e.O()}]);
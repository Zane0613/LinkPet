(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{7128:function(e,t,a){Promise.resolve().then(a.bind(a,5040))},5040:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(3827),n=a(4090),s=a(8792),l=a(826),o=a(7907);function c(){let e=(0,o.useRouter)(),[t,a]=(0,n.useState)([]),[c,d]=(0,n.useState)(""),[i,u]=(0,n.useState)(!1),[x,p]=(0,n.useState)(null),b=(0,n.useRef)(null);(0,n.useEffect)(()=>{l.Z.get("/pet/my/all").then(t=>{t.data&&t.data.length>0?(p(t.data[0].id),a([{role:"pet",content:"你好！我是 ".concat(t.data[0].name,"。今天想聊点什么？")}])):e.push("/hatch")})},[e]),(0,n.useEffect)(()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[t]);let h=async()=>{if(c.trim()&&x&&!i){d(""),a(e=>[...e,{role:"user",content:c}]),u(!0);try{let e=await l.Z.post("/chat/send",{pet_id:x,message:c});a(t=>[...t,{role:"pet",content:e.data.reply}])}catch(e){console.error("Chat error:",e),a(e=>[...e,{role:"pet",content:"..."}])}finally{u(!1)}}};return(0,r.jsxs)("div",{className:"min-h-screen bg-[#FFF8E7] flex flex-col",children:[(0,r.jsxs)("header",{className:"bg-white p-4 shadow-[0px_4px_0px_0px_rgba(0,0,0,0.1)] border-b-2 border-black flex items-center gap-4 sticky top-0 z-10",children:[(0,r.jsx)(s.default,{href:"/home",className:"text-2xl font-black text-black hover:scale-110 transition-transform",children:"←"}),(0,r.jsx)("h1",{className:"font-black text-xl text-black",children:"与宠物聊天"})]}),(0,r.jsxs)("div",{className:"flex-1 p-4 space-y-4 overflow-y-auto",children:[t.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,r.jsx)("div",{className:"max-w-[80%] p-3 rounded-2xl border-2 border-black shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] text-sm md:text-base font-medium ".concat("user"===e.role?"bg-[#FFB347] text-black rounded-tr-none":"bg-white text-black rounded-tl-none"),children:e.content})},t)),i&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsx)("div",{className:"bg-white border-2 border-black p-3 rounded-2xl rounded-tl-none text-gray-400 text-sm animate-pulse shadow-[2px_2px_0px_0px_rgba(0,0,0,1)]",children:"思考中..."})}),(0,r.jsx)("div",{ref:b})]}),(0,r.jsxs)("div",{className:"p-4 bg-white border-t-2 border-black flex gap-2",children:[(0,r.jsx)("input",{value:c,onChange:e=>d(e.target.value),onKeyDown:e=>"Enter"===e.key&&h(),placeholder:"输入消息...",disabled:i,className:"flex-1 p-3 border-2 border-black rounded-xl px-4 focus:outline-none focus:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] transition-shadow bg-[#FFF8E7] text-black placeholder-gray-500 font-medium"}),(0,r.jsx)("button",{onClick:h,disabled:i||!c.trim(),className:"bg-[#FFB347] border-2 border-black text-black p-3 rounded-xl w-12 h-12 flex items-center justify-center hover:translate-y-[-2px] hover:shadow-[2px_2px_0px_0px_rgba(0,0,0,1)] active:translate-y-[0px] active:shadow-none disabled:opacity-50 transition-all font-black",children:"➤"})]})]})}},826:function(e,t,a){"use strict";let r=a(3107).Z.create({baseURL:"/api/v1",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{{let t=localStorage.getItem("linkpet_user_id");t&&(e.headers["X-User-ID"]=t)}return e},e=>Promise.reject(e)),t.Z=r},8792:function(e,t,a){"use strict";a.d(t,{default:function(){return n.a}});var r=a(5250),n=a.n(r)}},function(e){e.O(0,[615,250,971,69,744],function(){return e(e.s=7128)}),_N_E=e.O()}]);
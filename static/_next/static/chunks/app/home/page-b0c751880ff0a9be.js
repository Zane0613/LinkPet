(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{3434:function(e,t,r){Promise.resolve().then(r.bind(r,8899))},8899:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var a=r(3827),n=r(4090),s=r(8792),l=r(826),i=r(7907),c=r(4391);function o(e){let{diaries:t,onClose:r}=e,[s,l]=(0,n.useState)(0),i=t[s],c=new Date(i.created_at).toLocaleDateString();return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"relative w-full max-w-2xl px-4",children:[(0,a.jsx)("button",{onClick:r,className:"absolute top-0 right-0 m-4 z-50 bg-white rounded-full p-2 border-2 border-black hover:bg-gray-100",children:"❌"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("button",{onClick:()=>{s>0&&l(s-1)},disabled:0===s,className:"p-3 bg-white border-2 border-black rounded-full transition-opacity ".concat(0===s?"opacity-30 cursor-not-allowed":"hover:bg-gray-100"),children:"⬅️"}),(0,a.jsxs)("div",{className:"mx-4 flex-1 bg-white border-4 border-black rounded-3xl p-6 shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] relative min-h-[400px] flex flex-col",children:[(0,a.jsxs)("div",{className:"text-center mb-4 border-b-2 border-dashed border-gray-300 pb-2",children:[(0,a.jsx)("span",{className:"inline-block bg-orange-100 px-3 py-1 rounded-full text-sm font-bold border border-black mb-2",children:c}),(0,a.jsx)("h2",{className:"text-2xl font-zcool font-bold",children:i.title})]}),i.image_url&&(0,a.jsx)("div",{className:"mb-4 rounded-xl border-2 border-black overflow-hidden shadow-md flex-shrink-0",children:(0,a.jsx)("img",{src:i.image_url,alt:i.title,className:"w-full h-auto max-h-64 object-cover",onError:e=>e.currentTarget.style.display="none"})}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto mb-4 font-handwriting text-lg leading-relaxed whitespace-pre-wrap",children:i.content}),(0,a.jsxs)("div",{className:"text-center text-gray-400 text-sm",children:[s+1," / ",t.length]})]}),(0,a.jsx)("button",{onClick:()=>{s<t.length-1&&l(s+1)},disabled:s===t.length-1,className:"p-3 bg-white border-2 border-black rounded-full transition-opacity ".concat(s===t.length-1?"opacity-30 cursor-not-allowed":"hover:bg-gray-100"),children:"➡️"})]})]})})}var d=r(8371);function u(){let e=(0,i.useRouter)(),[t,r]=(0,n.useState)(null),[u,x]=(0,n.useState)(!0),h=(0,n.useRef)(void 0),[p,m]=(0,n.useState)(Date.now()),[f,b]=(0,n.useState)([]),[g,j]=(0,n.useState)(!1),[y,v]=(0,n.useState)(!1),_=(0,n.useRef)(null),w=(0,n.useRef)(!1);(0,n.useEffect)(()=>{_.current=t},[t]),(0,n.useEffect)(()=>{w.current=y||g},[y,g]),(0,n.useEffect)(()=>{k();let e=setInterval(k,5e3);return()=>clearInterval(e)},[]);let N=async e=>{if(!w.current)try{let t=(await l.Z.get("/trip/diaries?pet_id=".concat(e.id))).data,r=e.last_read_diary_id||0,a=t.filter(e=>e.id>r);a.length>0&&(b(a),j(!0))}catch(e){console.error("Failed to fetch diaries:",e)}},k=async()=>{try{let e=await l.Z.get("/pet/my/all");if(e.data&&e.data.length>0){let t=e.data,a=t[t.length-1],n=a.status,s=_.current;if(!s){r(a),h.current=n,x(!1),N(a);return}if(h.current&&h.current!==n){let e=h.current;r(a),h.current=n,m(Date.now()),"traveling"===e&&N(a)}else(s.name!==a.name||s.template_id!==a.template_id||s.last_read_diary_id!==a.last_read_diary_id)&&r(a),"traveling"!==n&&0===f.length&&N(a)}}catch(e){console.error("Failed to fetch pets",e)}finally{u&&x(!1)}};(0,n.useEffect)(()=>{t&&("egg_frozen"===t.status||"egg_heating"===t.status||"egg"===t.status||"egg_dead"===t.status?e.push("/hatch"):"egg_hatched"===t.status&&e.push("/naming"))},[t,e]);let E=async()=>{if(v(!1),t&&f.length>0){let e=Math.max(...f.map(e=>e.id));try{await l.Z.post("/pet/read_diary",{last_read_diary_id:e}),r({...t,last_read_diary_id:e}),b([])}catch(e){console.error("Failed to update read diary:",e)}}};if(u)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"加载中..."});if(!t)return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"未找到宠物"}),(0,a.jsx)("p",{className:"mb-8 text-gray-600",children:"你还没有孵化宠物哦！"}),(0,a.jsx)(s.default,{href:"/hatch",className:"px-6 py-3 bg-blue-600 text-white rounded-lg",children:"去孵化屋"})]});if("egg_frozen"===t.status||"egg_heating"===t.status||"egg"===t.status||"egg_dead"===t.status)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#FFF8E7]",children:"正在前往孵化屋..."});if("egg_hatched"===t.status)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#FFF8E7]",children:"正在前往起名页面..."});let C=t.template_id,T=t.status||"sleeping",D="traveling"===T,z=D?"/images/backgrounds/home-bg.png":"/images/pets/".concat(C,"_").concat(T,".png");return(0,a.jsx)("div",{className:"min-h-screen relative bg-[#f0f9ff] overflow-hidden",children:(0,a.jsxs)(d.E.div,{className:"relative z-10 min-h-screen flex flex-col justify-between",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:[(0,a.jsxs)("header",{className:"p-6 flex justify-between items-center z-20",children:[(0,a.jsxs)("div",{className:"relative transform -rotate-2 hover:scale-105 transition-transform duration-300",children:[(0,a.jsx)("img",{src:"/images/ui/title_bg.png",alt:"Title Background",className:"h-12 md:h-14 w-auto object-contain drop-shadow-md",onError:e=>{var t;e.currentTarget.style.display="none",null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("bg-white","border-4","border-black","rounded-2xl","shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]")}}),(0,a.jsxs)("h1",{className:"absolute inset-0 flex items-center justify-center text-lg md:text-xl font-zcool text-black pb-1",children:[t.name,"的家"]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)(s.default,{href:"/diary",className:"group relative hover:scale-105 transition-transform duration-300",children:[(0,a.jsx)("img",{src:"/images/ui/diary_btn.png",alt:"旅行日记",className:"h-12 md:h-14 w-auto object-contain drop-shadow-md",onError:e=>{var t;e.currentTarget.style.display="none",null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("px-5","py-2","bg-white","border-2","border-black","rounded-xl","font-bold","text-black","shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"),e.currentTarget.parentElement.innerText="\uD83D\uDCD6 旅行日记"}}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center font-zcool text-black text-lg md:text-xl pointer-events-none pb-1",children:"日记"})]}),(0,a.jsxs)(s.default,{href:"/chat",className:"group relative hover:scale-105 transition-transform duration-300",children:[(0,a.jsx)("img",{src:"/images/ui/chat_btn.png",alt:"聊天",className:"h-12 md:h-14 w-auto object-contain drop-shadow-md",onError:e=>{var t;e.currentTarget.style.display="none",null===(t=e.currentTarget.parentElement)||void 0===t||t.classList.add("px-5","py-2","bg-white","border-2","border-black","rounded-xl","font-bold","text-black","shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]"),e.currentTarget.parentElement.innerText="\uD83D\uDCAC 聊天"}}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center font-zcool text-black text-lg md:text-xl pointer-events-none pb-1",children:"聊天"})]})]})]}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("img",{src:z,alt:"Home Background",className:"absolute inset-0 w-full h-full object-cover"}),(0,a.jsxs)("div",{className:"relative z-10 bg-white/90 p-6 rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] text-center transform rotate-2",children:[(0,a.jsx)("p",{className:"text-2xl font-black mb-2",children:"✈️ 旅行中"}),(0,a.jsx)("p",{className:"text-gray-600 font-bold",children:"我会给你带礼物回来的！"})]})]}):(0,a.jsx)(d.E.img,{src:z,alt:t.name,initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"w-full h-full object-cover cursor-pointer",onClick:()=>e.push("/chat"),onError:e=>{e.currentTarget.style.display="none",console.error("Failed to load image: ".concat(z));let t=e.currentTarget.parentElement;if(t){let e=document.createElement("div");e.className="absolute inset-0 flex items-center justify-center text-red-500 font-bold bg-white/50 rounded-lg p-4",e.innerHTML='\n                                <div class="text-center">\n                                    <p class="text-xl">\uD83D\uDE22</p>\n                                    <p>Image Missing</p>\n                                    <p class="text-xs mt-1 text-gray-600 break-all">'.concat(z,"</p>\n                                </div>\n                            "),t.appendChild(e)}}},z)}),(0,a.jsx)("div",{className:"h-20"}),(0,a.jsx)(c.Z,{isOpen:g,onClose:()=>j(!1),onConfirm:()=>{j(!1),v(!0)},title:"新的旅行日记",confirmText:"查看日记",cancelText:"稍后再看",type:"confirm",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("p",{children:["你的宠物 ",t.name," 给你带回了新的日记！"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"是否现在查看？"})]})}),y&&(0,a.jsx)(o,{diaries:f,onClose:E})]})})}},4391:function(e,t,r){"use strict";r.d(t,{Z:function(){return j}});var a=r(3827),n=r(4090),s=r(3856),l=r(2435),i=r(4561),c=r(3449);class o extends n.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d(e){let{children:t,isPresent:r}=e,s=(0,n.useId)(),l=(0,n.useRef)(null),i=(0,n.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,n.useContext)(c._);return(0,n.useInsertionEffect)(()=>{let{width:e,height:t,top:a,left:n}=i.current;if(r||!l.current||!e||!t)return;l.current.dataset.motionPopId=s;let c=document.createElement("style");return d&&(c.nonce=d),document.head.appendChild(c),c.sheet&&c.sheet.insertRule('\n          [data-motion-pop-id="'.concat(s,'"] {\n            position: absolute !important;\n            width: ').concat(e,"px !important;\n            height: ").concat(t,"px !important;\n            top: ").concat(a,"px !important;\n            left: ").concat(n,"px !important;\n          }\n        ")),()=>{document.head.removeChild(c)}},[r]),(0,a.jsx)(o,{isPresent:r,childRef:l,sizeRef:i,children:n.cloneElement(t,{ref:l})})}let u=e=>{let{children:t,initial:r,isPresent:s,onExitComplete:c,custom:o,presenceAffectsLayout:u,mode:h}=e,p=(0,l.h)(x),m=(0,n.useId)(),f=(0,n.useCallback)(e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;c&&c()},[p,c]),b=(0,n.useMemo)(()=>({id:m,initial:r,isPresent:s,custom:o,onExitComplete:f,register:e=>(p.set(e,!1),()=>p.delete(e))}),u?[Math.random(),f]:[s,f]);return(0,n.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[s]),n.useEffect(()=>{s||p.size||!c||c()},[s]),"popLayout"===h&&(t=(0,a.jsx)(d,{isPresent:s,children:t})),(0,a.jsx)(i.O.Provider,{value:b,children:t})};function x(){return new Map}var h=r(3177);let p=e=>e.key||"";function m(e){let t=[];return n.Children.forEach(e,e=>{(0,n.isValidElement)(e)&&t.push(e)}),t}var f=r(5526);let b=e=>{let{children:t,custom:r,initial:i=!0,onExitComplete:c,presenceAffectsLayout:o=!0,mode:d="sync",propagate:x=!1}=e,[b,g]=(0,h.oO)(x),j=(0,n.useMemo)(()=>m(t),[t]),y=x&&!b?[]:j.map(p),v=(0,n.useRef)(!0),_=(0,n.useRef)(j),w=(0,l.h)(()=>new Map),[N,k]=(0,n.useState)(j),[E,C]=(0,n.useState)(j);(0,f.L)(()=>{v.current=!1,_.current=j;for(let e=0;e<E.length;e++){let t=p(E[e]);y.includes(t)?w.delete(t):!0!==w.get(t)&&w.set(t,!1)}},[E,y.length,y.join("-")]);let T=[];if(j!==N){let e=[...j];for(let t=0;t<E.length;t++){let r=E[t],a=p(r);y.includes(a)||(e.splice(t,0,r),T.push(r))}"wait"===d&&T.length&&(e=T),C(m(e)),k(j);return}let{forceRender:D}=(0,n.useContext)(s.p);return(0,a.jsx)(a.Fragment,{children:E.map(e=>{let t=p(e),n=(!x||!!b)&&(j===E||y.includes(t));return(0,a.jsx)(u,{isPresent:n,initial:(!v.current||!!i)&&void 0,custom:n?void 0:r,presenceAffectsLayout:o,mode:d,onExitComplete:n?void 0:()=>{if(!w.has(t))return;w.set(t,!0);let e=!0;w.forEach(t=>{t||(e=!1)}),e&&(null==D||D(),C(_.current),x&&(null==g||g()),c&&c())},children:e},t)})})};var g=r(8371);function j(e){let{isOpen:t,onClose:r,title:n,message:s,children:l,confirmText:i="好的",cancelText:c="取消",onConfirm:o,type:d="info"}=e;return(0,a.jsx)(b,{children:t&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,a.jsx)(g.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:r}),(0,a.jsxs)(g.E.div,{initial:{scale:.9,rotate:-2,opacity:0},animate:{scale:1,rotate:0,opacity:1},exit:{scale:.9,rotate:2,opacity:0},className:"relative bg-white p-8 rounded-2xl border-4 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] max-w-md w-full",children:[(0,a.jsx)("button",{onClick:r,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center border-2 border-black rounded-full hover:bg-gray-100 transition-colors",children:(0,a.jsx)("span",{className:"font-bold text-lg leading-none mb-1",children:"x"})}),(0,a.jsx)("h2",{className:"text-2xl font-black mb-4 text-center transform -rotate-1",children:n}),(0,a.jsx)("div",{className:"mb-8 text-lg font-medium text-gray-800 text-center leading-relaxed",children:s||l}),(0,a.jsxs)("div",{className:"flex justify-center gap-6",children:["confirm"===d&&(0,a.jsx)("button",{onClick:r,className:"px-6 py-2 bg-white border-2 border-black rounded-xl font-bold hover:bg-gray-50 active:translate-y-1 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,0.2)]",children:c}),(0,a.jsx)("button",{onClick:o||r,className:"px-6 py-2 bg-[#FFD700] border-2 border-black rounded-xl font-bold hover:brightness-105 active:translate-y-1 transition-all shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]",children:i})]})]})]})})}},826:function(e,t,r){"use strict";let a=r(3107).Z.create({baseURL:"/api/v1",headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("linkpet_user_id");t&&(e.headers["X-User-ID"]=t)}return e},e=>Promise.reject(e)),t.Z=a},8792:function(e,t,r){"use strict";r.d(t,{default:function(){return n.a}});var a=r(5250),n=r.n(a)}},function(e){e.O(0,[615,250,371,971,69,744],function(){return e(e.s=3434)}),_N_E=e.O()}]);